global
  log /dev/log local0
  user haproxy
  group haproxy

defaults
  log global
  option httplog
  maxconn 4096

frontend http_redirect
  mode http
  bind 0.0.0.0:80
  timeout client 50s
  redirect prefix https://<%= canonical_host %> code 301 

frontend overview_frontend
  mode http
  bind 0.0.0.0:443 ssl crt <%= config_path %>/ssl-cert-and-pk.pem

  timeout client 50s

  acl canonical_url hdr_dom(Host) eq <%= canonical_host %>
  redirect prefix https://<%= canonical_host %> code 301 if !canonical_url

  default_backend overview_backend

backend overview_backend
  mode http
  timeout connect 5s
  timeout server 30s

  server overview 127.0.0.1:<%= web_port %>
